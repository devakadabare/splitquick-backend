paths:
  /api/groups:
    post:
      tags:
        - Groups
      summary: Create a new group
      description: Create a new expense group. The creator is automatically assigned as admin.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGroupRequest'
      responses:
        '201':
          description: Group created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      tags:
        - Groups
      summary: Get user's groups
      description: Retrieve all groups the authenticated user is a member of
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of groups retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Group'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/groups/{groupId}:
    get:
      tags:
        - Groups
      summary: Get group details
      description: Retrieve detailed information about a specific group
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: groupId
          required: true
          schema:
            type: string
            format: uuid
          description: The group ID
      responses:
        '200':
          description: Group details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  name:
                    type: string
                  currency:
                    type: string
                  createdBy:
                    type: string
                    format: uuid
                  createdAt:
                    type: string
                    format: date-time
                  updatedAt:
                    type: string
                    format: date-time
                  members:
                    type: array
                    items:
                      $ref: '#/components/schemas/GroupMember'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - user is not a member of this group
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Groups
      summary: Delete group
      description: Soft delete a group (admin only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: groupId
          required: true
          schema:
            type: string
            format: uuid
          description: The group ID
      responses:
        '200':
          description: Group deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Group deleted successfully'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - only admins can delete groups
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/groups/{groupId}/members:
    post:
      tags:
        - Groups
      summary: Add member to group
      description: Add a new member to the group by email address
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: groupId
          required: true
          schema:
            type: string
            format: uuid
          description: The group ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddMemberRequest'
      responses:
        '201':
          description: Member added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupMember'
        '400':
          description: Bad request - user already a member or not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - user is not a member of this group
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/groups/{groupId}/members/{memberId}:
    delete:
      tags:
        - Groups
      summary: Remove member from group
      description: Remove a member from the group (admin only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: groupId
          required: true
          schema:
            type: string
            format: uuid
          description: The group ID
        - in: path
          name: memberId
          required: true
          schema:
            type: string
            format: uuid
          description: The member user ID
      responses:
        '200':
          description: Member removed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 'Member removed successfully'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - only admins can remove members
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/groups/{groupId}/members/{memberId}/role:
    patch:
      tags:
        - Groups
      summary: Update member role
      description: Update a member's role in the group (admin only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: groupId
          required: true
          schema:
            type: string
            format: uuid
          description: The group ID
        - in: path
          name: memberId
          required: true
          schema:
            type: string
            format: uuid
          description: The member user ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRoleRequest'
      responses:
        '200':
          description: Member role updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupMember'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - only admins can update roles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
